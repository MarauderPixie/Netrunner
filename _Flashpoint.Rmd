---
title: "Flashpoint Cycle"
date: "`r ddateR::poee()`"
output: html_document
---

```{r, init, echo = F, warning = F, message = F}
source(paste0(Sys.getenv("PROJECT_HOME"), "./init.R"))
knitr::opts_chunk$set(fig.path = "assets/highscore-plots/Flashpoint")

score         <- filter(score, Cycle == "Flashpoint")
runner_score  <- filter(runner_score, Cycle == "Flashpoint")
konzern_score <- filter(konzern_score, Cycle == "Flashpoint")
```


# Leaderboard & Played Games

## Highscore

```{r, Flashpoint_Liste}
  score %>% 
    group_by(Spieler) %>% 
    summarize(Spiele = n(),
              Siege  = sum(Punkte)/2,
              Ratio  = percent((sum(Punkte)/2)/Spiele, 1)) %>%
    arrange(desc(Ratio), desc(Siege), Spiele) %>% 
    format_table(list(
      Spiele = color_tile("white", "lightgreen"),
      align = "l", check.rows = F, format = "markdown"))
```

## Attempted Security Breaches

```{r, Flashpoint_Spieluebersicht}
as.data.frame.matrix(crossprod(table(score$Spiel, score$Spieler))) %>% 
  gather(Spieler, Spiele, Andi, Aschkan, Boray, 
         Falk, Jan, Josh, Kai, Ole, Paul, Tobias) %>% 
  mutate(Gegner = rep(unique(Spieler), length(unique(Spieler)))) %>% 
  filter(Spieler != Gegner, Spiele != 0) %>% 
  ggplot(., aes(x = Spieler, y = Gegner, fill = Spiele)) + 
    geom_tile(color = "white", size = 0.5, alpha = 0.9) +
    geom_text(aes(label = Spiele), color = "gray") +
    labs(x = NULL, y = NULL) +
    scale_fill_viridis(option = "B") +
    cosmetics + theme(legend.position = "top")
```

## Wins per player by side

```{r SeiteproSpieler}
wins <- score %>% 
  group_by(Seite, Spieler) %>% 
  summarize(Spiele  = n(),
            Siege   = sum(Punkte)/2,
            Prozent = round(Siege / Spiele * 100, 1)) %>% 
  mutate(Prozent = ifelse(Seite == "Konzern", Prozent * -1, Prozent * 1))

ggplot(wins, aes(x = Spieler, color = Seite)) +
  geom_linerange(data = wins[wins$Seite == "Runner", ],
                 aes(ymin = 10, ymax = 10 + Prozent), size = 9, alpha = 0.8) +
  
  geom_linerange(data = wins[wins$Seite == "Konzern", ],
                 aes(ymin = -10, ymax = -10 + Prozent), size = 9, alpha = 0.8) +
  
  geom_label(aes(x = Spieler, y = 0, label = Spieler, family = "sans"), 
             inherit.aes = F, size = 5, label.padding = unit(0.0, "lines"), 
             label.size = 0, label.r = unit(0.0, "lines"), color = "black") +
  
  scale_y_continuous(breaks = c(c(-100, -80, -60, -40, -20, 0) + -10, 
                                c(0, 20, 40, 60, 80, 100) + 10),
                     labels = c("100%", "80%", "60%", "40%", "20%", "0%",
                                "0%", "20%", "40%", "60%", "80%", "100%")) +
  
  labs(x = NULL, y = NULL, title = "Siege pro Spieler pro Seite") +
  
  scale_color_manual(name = "", values = c(Konzern = "#3288bd", Runner = "#d53e4f"),
                     labels = c("Konzern", "Runner")) +
  
  theme_hc() + coord_flip() + 
  theme(axis.text.y   = element_blank(), panel.grid.major.x = element_line(color = "gray"),
        axis.ticks.y  = element_blank(), panel.grid.major.y = element_blank(),
        legend.position = "top", title = element_text(size = 14), 
        axis.text    = element_text(size = 12),
        legend.title = element_text(size = 12),
        legend.text  = element_text(size = 10),
        strip.text   = element_text(size = 14))
```